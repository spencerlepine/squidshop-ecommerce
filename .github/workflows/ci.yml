name: CI

on:
  push:
    branches:
      - 'main'
  pull_request:

jobs:
  gateway_ci:
    env:
      service: 'gateway'
    name: "ðŸ§ª Node CI"
    uses: ./.github/workflows/node_ci.yml
    with:
      working_directory: ./${{ env.service }}
      module_name: ${{ env.service }}

  gateway_coverage:
    needs: [gateway_ci]
    runs-on: ubuntu-latest
    env:
      service: 'gateway'

    name: Gateway Coverage Comment
    steps:
      - name: Download Test Covereage Output
        uses: actions/download-artifact@v3
        with:
          name: ${{ env.service }}-code-coverage-report

      - name: Add Coverage PR Comment
        uses: marocchino/sticky-pull-request-comment@v2
        if: github.event_name == 'pull_request'
        with:
          header: gateway
          recreate: true
          path: ${{ env.service }}-code-coverage-results.md