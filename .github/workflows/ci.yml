name: CI

on:
  push:
    branches:
      - 'main'
  pull_request:

jobs:
  node_ci:
    name: "🧪 Node CI"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        service: ['gateway', 'products', 'users']

    steps:
      - name: "☁️ Check out Git Repository"
        uses: actions/checkout@v2

      - name: 🧪 CI (${{ matrix.service }})
        uses: ./.github/workflows/node_ci.yml@main
        with:
          working_directory: ./${{ matrix.service }}
          module_name: ${{ matrix.service }}

    # name: 🧪 CI (${{ matrix.service }})
    # steps:
    #   - name: "☁️ Check out Git Repository"
    #     uses: actions/checkout@v2

    #   - name: "🧪 Node CI"
    #     uses: ./.github/workflows/node_ci.yml
    #     with:
    #       working_directory: ./${{ matrix.service }}
    #       module_name: ${{ matrix.service }}

      # - name: Download Test Covereage Output
      #   uses: actions/download-artifact@v3
      #   with:
      #     name: gateway-code-coverage-report

      # - name: Add Coverage PR Comment
      #   uses: marocchino/sticky-pull-request-comment@v2
      #   if: github.event_name == 'pull_request'
      #   with:
      #     header: gateway
      #     recreate: true
      #     path: -code-coverage-results.md